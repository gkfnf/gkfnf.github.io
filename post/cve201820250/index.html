<!DOCTYPE html>
<html>

<head>
  <title> CVE-2018-20250 --&gt; WinRAR RCE &middot; Fkbug </title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.51" />




<link rel="stylesheet" href="/css/vec.min.css">

<link rel="stylesheet" href="/css/prism.css">

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/favicon.ico">


<link href="" rel="alternate" type="application/rss+xml" title="Fkbug" />




<script src="/js/prism.js" async="" ></script>


<script src="/js/btn.js" async=""></script>


</head>

<body>
  <header>
  <nav>
    <ul>
      
      
      
      
      <li class="pull-left">
        <a href="/post/cve201820250/"><i class="fas fa-list-ul" id="toc_btn"></i></a>
      </li>
      <li class="pull-left">
        <a href="https://fkbug.com">fkbug</a>
      </li>
      
      
      <li class="pull-left">
        <a href="/categories">post</a>
      </li>
      
      <li class="pull-right">
        <a href=""><i class="fas fa-lightbulb" id="bulb_btn"></i></a>
      </li>
    </ul>
  </nav>
</header>

  <div class="content wide">
    
    
    <section class="post">
      <h1 class="post-title"><a href="https://fkbug.com/post/cve201820250/">CVE-2018-20250 --&gt; WinRAR RCE</a></h1>
      <span class="post-date">Feb 20, 2019 </span>
      <div class="post-content">
        

<h2 id="效果">效果</h2>

<blockquote>
<p>当对恶意的 <code>.rar</code> 压缩包进行 <strong>双击解压</strong> 或 <strong>解压到当前目录</strong> 时，恶意的压缩包可以释放恶意文件到<code>Windows</code>系统启动项， 在系统 <strong>重启后执行任意代码</strong>。</p>
</blockquote>

<p><strong>Ref:</strong> &nbsp; <a href="https://research.checkpoint.com/extracting-code-execution-from-winrar/">https://research.checkpoint.com/extracting-code-execution-from-winrar/</a></p>

<p>受影响软件:</p>

<ul>
<li><code>Winrar</code>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>&lt; 5.70</strong></li>
<li><code>Bandizip</code> &nbsp;&nbsp;&nbsp;&nbsp;<strong>&lt; 6.21</strong></li>
<li><code>2345 好压</code> &nbsp;&nbsp;<strong>&lt; 5.9.8</strong></li>
<li><code>360 压缩</code> &nbsp;&nbsp;&nbsp;&nbsp;<strong>&lt; 4.1180</strong></li>
<li><code>。。。</code></li>
</ul>

<h2 id="成因">成因</h2>

<blockquote>
<p>WinRar  解析 <strong>ACE</strong> 压缩格式的库 <strong>UNACEV2.dll</strong> 自从 19 年前就没更新过了, 而该库未开启 <strong>ASLR</strong> 及 <strong>DEP</strong> 等保护措施，且 <strong>对文件路径的处理逻辑</strong> 存在安全隐患</p>
</blockquote>

<p>背景知识：







  <iframe
    class="shengxiang"
    width="800"
    height="450"
    scrolling="no"
    frameborder="0"
    allowfullscreen
    src="https://ppt.baomitu.com/embed/adab6b4a?style=dark">
  </iframe>


</p>

<h3 id="unacev2-dll-中的漏洞代码"><strong>UNACEV2.dll</strong> 中的漏洞代码:</h3>

<p>首先在 <strong>IDA</strong> 里边看看这个<strong>DLL</strong> 的基本信息可以发现, 导出的一些函数:</p>

<p><img src="/images/cve201820250/UNACEV2_0.png" alt="导出表" /></p>

<p>然后可以使用 <strong>GitPrey</strong> 来搜索导出函数 <strong>ACEInitDll</strong> 来寻找相关的开源项目尝试获取更多信息:</p>

<ul>
<li><p>GitPrey 安装及配置：</p></li>

<li><p>通过关键词搜索相关项目:</p>

<p><img src="/images/cve201820250/GitPrey1.png" alt="ACEInitDll_Relate" /></p></li>
</ul>

<p>随便选个相关项目在里边找找, 可以看到找到了 UNACEV2.dll 的一些头文件：</p>

<p><img src="/images/cve201820250/UNACEV2_1.png" alt="UNACEV2.dll" /></p>

<p>读一读注释, 然后在 <strong>IDA</strong> 里边再加载一下找到的头文件：
<img src="/images/cve201820250/IDA_LoadFile.png" alt="IDA_LoadFile" /></p>

      </div>
    </section>
    
    <section class="pagination clearfix">
       
      
    </section>
    
    
  </div>
  
  <footer>
<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <div class="footer-info">
    <p>
      <a href="mailto:978694661@qq.com?subject="><i class="far fa-envelope"></i> Fkbug</a>
      |
        <a href="https://gohugo.io/" title="Hugo :: A fast and modern static website engine">0.51  </a>|
        <a href="https://github.com/gkfnf/gkfnf.github.io" title="Fk">Fk</a>  
      |
      <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" title="CC BY-NC-ND 3.0">CC BY-NC-ND 3.0</a>
    </p>
  </div>
</footer>
  

  

</body>

</html>
