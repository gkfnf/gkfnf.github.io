<!DOCTYPE html>
<html>

<head>
  <title> 0. Base Architecture &middot; Fkbug </title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.51" />




<link rel="stylesheet" href="/css/vec.min.css">

<link rel="stylesheet" href="/css/prism.css">

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/favicon.ico">


<link href="" rel="alternate" type="application/rss+xml" title="Fkbug" />




<script src="/js/prism.js" async="" ></script>


<script src="/js/btn.js" async=""></script>


</head>

<body>
  <header>
  <nav>
    <ul>
      
      
      
      
      <li class="pull-left">
        <a href="/post/vulnerability/"><i class="fas fa-list-ul" id="toc_btn"></i></a>
      </li>
      <li class="pull-left">
        <a href="https://fkbug.com">fkbug</a>
      </li>
      
      
      <li class="pull-left">
        <a href="/categories">post</a>
      </li>
      
      <li class="pull-right">
        <a href=""><i class="fas fa-lightbulb" id="bulb_btn"></i></a>
      </li>
    </ul>
  </nav>
</header>

  <div class="content toc">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#漏洞成因">漏洞成因</a></li>
</ul></li>
<li><a href="#test1">test1</a>
<ul>
<li><a href="#test2">test2</a>
<ul>
<li><a href="#test3">test3</a>
<ul>
<li><a href="#test6">test6</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#test1-1">test1</a>
<ul>
<li><a href="#test2-1">test2</a>
<ul>
<li><a href="#test3-1">test3</a>
<ul>
<li><a href="#test6-1">test6</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#test1-2">test1</a>
<ul>
<li><a href="#test2-2">test2</a>
<ul>
<li><a href="#test3-2">test3</a>
<ul>
<li><a href="#test6-2">test6</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#test1-3">test1</a>
<ul>
<li><a href="#test2-3">test2</a>
<ul>
<li><a href="#test3-3">test3</a>
<ul>
<li><a href="#test6-3">test6</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#test1-4">test1</a>
<ul>
<li><a href="#test2-4">test2</a>
<ul>
<li><a href="#test3-4">test3</a>
<ul>
<li><a href="#test6-4">test6</a></li>
</ul></li>
<li><a href="#web-安全框架">Web 安全框架：</a></li>
<li><a href="#1-web-基础知识">1. Web 基础知识 ?</a></li>
<li><a href="#二进制安全框架">二进制安全框架：</a>
<ul>
<li><a href="#1-二进制基础知识">1. 二进制基础知识</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    
    <section class="post">
      <h1 class="post-title"><a href="https://fkbug.com/post/vulnerability/">0. Base Architecture</a></h1>
      <span class="post-date">Oct 13, 2018 </span>
      <div class="post-content">
        

<h2 id="漏洞成因">漏洞成因</h2>

<p>个人理解，安全漏洞主要是下边两个原因导致的：</p>

<p><code>一 是未能正确区分数据和代码</code></p>

<p><code>二 是安全策略不周</code></p>

<p>怎么理解？</p>

<h1 id="test1">test1</h1>

<h2 id="test2">test2</h2>

<h3 id="test3">test3</h3>

<h4 id="test6">test6</h4>

<h1 id="test1-1">test1</h1>

<h2 id="test2-1">test2</h2>

<h3 id="test3-1">test3</h3>

<h4 id="test6-1">test6</h4>

<h1 id="test1-2">test1</h1>

<h2 id="test2-2">test2</h2>

<h3 id="test3-2">test3</h3>

<h4 id="test6-2">test6</h4>

<h1 id="test1-3">test1</h1>

<h2 id="test2-3">test2</h2>

<h3 id="test3-3">test3</h3>

<h4 id="test6-3">test6</h4>

<h1 id="test1-4">test1</h1>

<h2 id="test2-4">test2</h2>

<h3 id="test3-4">test3</h3>

<h4 id="test6-4">test6</h4>

<h3 id="web-安全框架">Web 安全框架：</h3>

<p>当我们访问一个网站时，具体发生了什么 ？</p>

<p>我们用一张图来说明：
<img src="/images/xss/web_Architecture.jpg" alt="Web 框架" /></p>

<p>为了解决这个问题，我们先 <strong>摸胸自问</strong> 一下：</p>

<ul>
<li>我有多了解网址 ？</li>
<li>我有多了解 HTTP ？</li>
<li>我有多了解网页 ？
<br/><br/></li>
</ul>

<h3 id="1-web-基础知识">1. Web 基础知识 ?</h3>

<p><strong>1. <code>url</code>: (Uniform Resource Location)统一资源定位符</strong></p>

<p>url 也就是所谓的网址， 是一种特殊类型的 <code>uri</code>(Uniform Resource Identifier) 统一资源标志符</p>

<pre><code class="language-python">用一串规定好的字符串来标识我们想要访问的网络资源，这样，当我们点击这个字符串或者在地址栏输入这个字符串时，
浏览器就会按照预先定义好的解析方式来解析这个字符串，确定我们想要访问什么资源
</code></pre>

<p><strong>WhatF ？</strong></p>

<p>说白了就是一套能唯一确定网络资源位置的命名方法</p>

<p><code>ps</code> :</p>

<ul>
<li>这里的资源就包括了我们常见的视频、图片、网页、文本等等的所有万维网上的资源。</li>
<li>这种用一串特定格式的字符串来作为标识的方法, 也被用来标识 <strong>物理设备</strong>：<code>MAC 地址</code>、 或者 <strong>主机</strong>：<code>IP 地址</code>、 或 <strong>域名</strong>：<code>DNS</code> 等</li>
<li>而 <code>URL</code> 与 <code>URI</code> 的不同在于，<code>URL</code> 这个字符串不仅标识了要访问的资源，还 <strong>表明了资源在网络上的位置和访问的方法</strong></li>
</ul>

<p><strong>那么 <code>URL</code> 是如何规定资源在网络上的位置和访问方法的呢？</strong></p>

<pre><code class="language-python"># url 标准格式： 
scheme : // IP :port /path   ?querystring1=value1  &amp;querystring2=value2
</code></pre>

<ul>
<li><code>scheme</code>: 指定了底层使用的协议，常见的如 <code>HTTP/HTTPS/FTP</code>, 目前浏览器一般默认为 <code>HTTP</code> 开头</li>
<li><code>IP/CNAME</code>： 服务器的 <code>IP 地址</code>或者<code>域名</code>，<code>协议</code>与 <code>IP</code> 以 <code>//</code>（两个反斜线）隔开，表明了访问的网络位置。 通常说的墙，也就是墙的 IP</li>
<li><code>port</code>: <code>HTTP</code> 默认端口为 80， <code>HTTPS</code> 默认端口为 443。 如果当前请求为协议默认端口，则可省略端口号；如果不是默认端口，则需注明端口。并且，端口与域名之间用 <code>：</code>（冒号）隔开。</li>
<li><code>path</code>：访问资源的路径。在服务器中以 <code>WWW</code> 开头的路径， 通常表示访问文件的地点。 这个路径可以是相对路径，也可以是绝对路径</li>
<li><code>query-string</code>: 发送给服务器的数据。此时, 应用 <code>GET 方式</code> 传输才有效。 多个数据可用 <code>&amp;</code> 进行分割，实现多组数据同时传输</li>
</ul>

<p>以某新闻的链接为例：
<img src="/images/xss/xss_Url_format.png" alt="url 标准格式" /></p>

<p>可以看到， 在一个 <code>URL</code> 中：</p>

<ul>
<li><code>协议</code>、<code>端口号</code>、<code>发送给服务器的数据</code> 表明了 <strong>访问资源的方法</strong></li>
<li><code>IP/域名</code>、<code>资源路径</code> 表明了 <strong>资源在网络上的位置</strong></li>
</ul>

<p>现在，我们对网址有了一点肤浅的认识了。</p>

<p>但是，<strong>浏览器解析完 <code>URL</code>后， 确定了我们想访问的资源的位置之后， 具体又发生了什么？</strong></p>

<p>这便不得不提 <code>HTTP</code>协议 了：
<br/><br/>
<strong>2. <code>HTTP</code>:</strong></p>

<pre><code class="language-python">HTTP (Hyper Text Transfer Protocol, 超文本传输协议) 是 WEB (World Wide Web, WWW) 
# 万维网中客户端与服务端之间的交互标准
</code></pre>

<p><img src="/images/me/avatar.png" alt="浏览器与服务器交互过程" />
浏览器解析完 <code>URL</code> 后， 会向 <code>URL</code> 中指定的 IP或域名 所对应的服务器发送一个 <code>HTTP 请求包</code>， 然后服务器根据请求进行相应回应，并发出 <code>HTTP 响应包</code>，浏览器收到响应包，解析出响应包中附带的网页，渲染出页面。</p>

<p><strong>HTTP 请求包:</strong></p>

<p>设置完代理后我们在 firefox 中访问 www.cn.bing.com 截获一个请求包</p>

<ul>
<li>请求行： <code>Method Request-URI HTTP-Version CRLF</code>

<ol>
<li><code>Method</code>: <code>请求方法</code>: 用来告知 Web 服务器本次请求的主要目的。</li>
</ol></li>
</ul>

<pre><code class="language-python"># HTTP 中定义了多种请求方法(所有方法均为大写) 如下:
GET:                        请求获取 Request-URI 所标识的资源
POST:                       在 Request-URI 所标识的资源后附加新的数据
HEAD:                       请求获取由 Request-URI 所标识的资源的响应消息报头
PUT:                        请求服务器存储一个资源， 并用 Request-URI 作为其标识
DELETE:                     请求服务器删除 Request-URI 所标识的资源
TRACE:                      请求服务器回送收到的请求信息， 主要用于测试或诊断
CONNECT:                    保留，将来使用
</code></pre>

<p><strong>HTTP 响应包：</strong></p>

<ul>
<li><code>HTTP 状态码</code>:
<code>服务器状态码是用来告知客户端 Web 服务对本次请求的响应状态是什么。</code>

<ol>
<li><code>1XX</code>: 表示 <strong>提示信息</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表明请求已被成功接收， 继续处理。</li>
<li><code>2XX</code>: 表示 <strong>成功</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;说明请求已被成功接收、理解、接受。</li>
<li><code>3XX</code>: 表示 <strong>重定向</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要完成请求必须进行更进一步处理。</li>
<li><code>4XX</code>: 表示 <strong>客户端错误</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请求有语法错误或请求无法实现。</li>
<li><code>5XX</code>: 表示 <strong>服务器端错误</strong> &nbsp;&nbsp;服务器处理请求时出错。之后两位会利用不同的数字来代表当前服务的状态。</li>
</ol></li>
</ul>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>以下是常见的状态码及状态描述：</strong></p>

<pre><code class="language-python">200: Ok,                    客户端请求成功
203: Temporarily Moved,     页面临时重定向
301：Permanently Moved,     页面重定向
400: Bad Request,           客户端请求有语法错误， 不能被服务器所理解
401: Unauthorized,          请求未经授权， 这个状态码必须和 www-Authenticate 报头域一起用
403: Forbidden,             服务器收到请求，但是拒绝提供服务
404：Not Found,             请求资源不存在，或者请求无法实现
500：Internal Server Error, 服务器发生不可预期的错误
503: Server Unavailabe,     服务器当前不能处理客户端的请求，一段时间后可能恢复正常
</code></pre>

<p><strong>HTTP 头参数</strong></p>

<ul>
<li><code>user_agent</code>:</li>
<li><code>X-Forwarded-For</code>:</li>
<li><code>Referer</code></li>
<li><code>Clien_ip</code>:</li>
<li><code>Cookie</code>:</li>
</ul>

<p>可以将 Web 分为八层来看待问题：
<img src="/images/xss/Web_Security_level.png" alt="Web 安全问题分层" />
将特殊数据作为 Web 系统的输入, 根据是否对 <strong>数据和代码进行了正确区分</strong>，在 Web 的各层便构成了不同种类的安全问题：</p>

<ul>
<li>在操作系统层， 如果没有对输入数据处理好， 将数据当成了代码执行，便构成了 OS 命令执行的问题。   通常导致 OS 命令执行的是一些 RCE 漏洞, 这时构造的恶意数据便是我们二进制里说的 <code>Shellcode</code>, 也就是汇编字节码。 <br/>但是有时候因为命令行的一些漏洞， 导致直接输入一些 Bash 或 Powershell 脚本得到了执行， 这时特殊数据便可能是一些命令行脚本， 如:</li>
</ul>

<pre><code class="language-shell">rm -rm/
</code></pre>

<ul>
<li>在数据的存储层， 如果没有处理好输入的数据， 数据库的 SQL 解析引擎把这个特殊数据当成代码执行了， 就导致了 sql 注入的问题, 可能的特殊数据便是 精心构造的 sql 语句, 如：</li>
</ul>

<pre><code class="language-sql">'union select user, pwd, 1, 2, 3, 4, from users--
</code></pre>

<ul>
<li>而如果在 Web 容器层如 Nginx 中没有处理好输入的数据， 由于 Nginx 或 Apache 自身的漏洞，将特殊数据当成代码执行了, 便可能产生 远程溢出、 DDos 等安全问题; 可能的特殊数据是：</li>
</ul>

<pre><code class="language-python">%c0.%c0./%c0.%c0./%c0.%c0./%c0.%c0./%20 
</code></pre>

<ul>
<li>而在 Web 开发框架或 Web 应用层没有处理好输入的数据， 将特殊数据当成了代码执行，便产生了远程命令执行的问题，可能的特殊数据便是 精心构造的 php 的代码, 如：</li>
</ul>

<pre><code class="language-php"> eval($_REQUEST['x'])
</code></pre>

<ul>
<li>而如果在 Web 前端层中没有处理好输入的数据， 浏览器的 JS 引擎把特殊数据当成了代码执行了， 便构成了 XSS 跨站脚本的安全问题， 可能特殊数据便是 精心构造的 Javascript 的代码, 如：</li>
</ul>

<pre><code class="language-javascript"> '&quot;&gt;&lt;script&gt;alert(/Fkbug/)&lt;/script&gt;
</code></pre>

<p>以上 Web 安全问题都是因为未能正确的处理输入的数据流，而将输入数据当成代码执行了， 即都是由于 <strong>未能正确区分数据和代码</strong> 而导致的安全问题
<br/><br/>
至于剩下的一些诸如：</p>

<ul>
<li>敏感信息泄露</li>
<li>逻辑漏洞</li>
<li>SSRF</li>
<li>CSRF</li>
<li>&hellip;&hellip;&hellip;</li>
</ul>

<p>大体上基本都是因为 <strong>安全策略考虑不周</strong> 导致的</p>

<h3 id="二进制安全框架">二进制安全框架：</h3>

<h4 id="1-二进制基础知识">1. 二进制基础知识</h4>

<ul>
<li>栈溢出 是因为数据把栈覆盖了被当成了代码被执行了</li>
<li>堆喷   是因为数据把堆覆盖了被当成了代码被执行了</li>
</ul>

<p>诸如 <code>格式化字符串</code>， <code>UAF（释放后重用）</code>, <code>DDOS(拒绝服务)</code> 等基本可以说都是上边两种的子集。</p>

<p>这两种类型江湖人称 &mdash;&mdash;&mdash;&mdash;&mdash;- <code>溢出</code><br />
皆是因 <strong>未能正确区分数据和代码</strong> 而掀起的腥风血雨</p>

<p>至于下边这几种：</p>

<ul>
<li>加密缺陷</li>
<li>凭据管理不当</li>
<li>信息泄露</li>
<li>。。。</li>
</ul>

<p>则基本都可以说是 <strong>安全策略考虑不周</strong> 造成的</p>

      </div>
    </section>
    
    <section class="pagination clearfix">
      
      <a class="btn previous " href="https://fkbug.com/post/xss/"> 0. XSS 基础  </a> 
       
      
    </section>
    
    
  </div>
  
  <footer>
    <script src="//yihui.name/js/math-code.js"></script>
    <script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <div class="footer-info">
    <p>
      <a href="mailto:978694661@qq.com?subject="><i class="far fa-envelope"></i> Fkbug</a>
      |
        <a href="https://gohugo.io/" title="Hugo :: A fast and modern static website engine">0.51  </a>|
        <a href="https://github.com/IvanChou/yii.im" title="vec">Fk</a>  
      |
      <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" title="CC BY-NC-ND 3.0">CC BY-NC-ND 3.0</a>
    </p>
  </div>
</footer>
  

  

</body>

</html>
